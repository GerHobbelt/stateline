#!/bin/bash

if [ $# -eq 0 ]; then
  echo "Usage: $0 <debug|release>" 1>&2
  exit 1
fi

STATELINE_SOURCE_DIR=$(pwd)

# Set PREREQ_DIR
if [ -z "${PREREQ_DIR}" ]; then
  PREREQ_DIR="${STATELINE_SOURCE_DIR}/build/prereqs"
fi
echo "PREREQ_DIR set to '${PREREQ_DIR}'."

# Set BUILD_DIR
if [ -z "${BUILD_DIR}" ]; then
  BUILD_DIR="${STATELINE_SOURCE_DIR}/build/$1"
fi
echo "BUILD_DIR set to '${BUILD_DIR}'."

mkdir -p $BUILD_DIR && cd $BUILD_DIR

if [ $1 = "debug" ]; then
  cmake $STATELINE_SOURCE_DIR -DSTATELINE_BINARY_DIR=$(pwd) -DSTATELINE_SOURCE_DIR=$STATELINE_SOURCE_DIR -DPREREQ_DIR=$PREREQ_DIR ${@:2}
elif [ $1 = "release" ]; then
  cmake $STATELINE_SOURCE_DIR -DSTATELINE_BINARY_DIR=$(pwd) -DSTATELINE_SOURCE_DIR=$STATELINE_SOURCE_DIR -DPREREQ_DIR=$PREREQ_DIR -DCMAKE_BUILD_TYPE=Release ${@:2}
elif [ $1 = "relwithdebinfo" ]; then
  cmake $STATELINE_SOURCE_DIR -DSTATELINE_BINARY_DIR=$(pwd) -DSTATELINE_SOURCE_DIR=$STATELINE_SOURCE_DIR -DPREREQ_DIR=$PREREQ_DIR -DCMAKE_BUILD_TYPE=RelWithDebInfo ${@:2}
fi
